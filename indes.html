<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Double Jump Building Jumper</title>
    <style>
        body { margin: 0; overflow: hidden; background: #0a1128; font-family: 'Arial', sans-serif; }
        canvas { display: block; }
        #ui {
            position: absolute; top: 20px; left: 20px; color: white;
            font-size: 28px; font-weight: bold; pointer-events: none;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        #msg {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: white; text-align: center; display: none;
            background: rgba(0,0,0,0.8); padding: 20px; border-radius: 10px;
        }
    </style>
</head>
<body>

    <div id="ui">Score: <span id="score">0</span></div>
    <div id="msg">
        <h1>GAME OVER</h1>
        <p>Click or Press Space to Restart</p>
    </div>
    <canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const msgEl = document.getElementById('msg');

// Set Canvas Size
function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// Game Settings
const gravity = 0.6;
const jumpPower = -13;
const gameSpeed = 6;

let score = 0;
let gameActive = true;
let buildings = [];

const player = {
    x: 150,
    y: 0,
    width: 25,
    height: 45,
    dy: 0,
    jumpCount: 0,
    maxJumps: 2
};

function createBuilding(x) {
    const width = 200 + Math.random() * 200;
    // Buildings can be quite tall now
    const height = 150 + Math.random() * (canvas.height * 0.6);
    return {
        x: x,
        y: canvas.height - height,
        width: width,
        height: height
    };
}

function init() {
    score = 0;
    scoreEl.innerText = score;
    gameActive = true;
    player.y = 50;
    player.dy = 0;
    player.jumpCount = 0;
    buildings = [];
    msgEl.style.display = 'none';
    
    // Create initial platforms
    let currentX = 50;
    for (let i = 0; i < 6; i++) {
        buildings.push(createBuilding(currentX));
        currentX += buildings[i].width + 120 + Math.random() * 100;
    }
}

function update() {
    if (!gameActive) return;

    // Physics
    player.dy += gravity;
    player.y += player.dy;

    // World Scroll
    buildings.forEach(b => {
        b.x -= gameSpeed;
    });

    // Collision Detection
    buildings.forEach(b => {
        if (player.x + player.width > b.x && 
            player.x < b.x + b.width &&
            player.y + player.height > b.y &&
            player.y + player.height < b.y + b.height + 10 && 
            player.dy >= 0) { // Only collide while falling
                player.y = b.y - player.height;
                player.dy = 0;
                player.jumpCount = 0; // Reset double jump
        }
    });

    // Add new buildings / Remove old ones
    if (buildings[0].x + buildings[0].width < 0) {
        const lastB = buildings[buildings.length - 1];
        const nextX = lastB.x + lastB.width + 140 + Math.random() * 120;
        buildings.shift();
        buildings.push(createBuilding(nextX));
        score++;
        scoreEl.innerText = score;
    }

    // Death
    if (player.y > canvas.height) {
        gameActive = false;
        msgEl.style.display = 'block';
    }
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw Buildings
    buildings.forEach(b => {
        ctx.fillStyle = '#1e272e';
        ctx.fillRect(b.x, b.y, b.width, b.height);
        
        // Windows
        ctx.fillStyle = '#f1c40f';
        for(let i=20; i < b.width - 20; i += 40) {
            for(let j=20; j < b.height - 20; j += 50) {
                ctx.fillRect(b.x + i, b.y + j, 12, 18);
            }
        }
    });

    // Draw Player
    // Red for 1st jump, Light Blue for 2nd jump
    ctx.fillStyle = player.jumpCount === 2 ? '#00d2d3' : '#ff6b6b';
    ctx.fillRect(player.x, player.y, player.width, player.height);
    
    // Eye on the player to show direction
    ctx.fillStyle = 'white';
    ctx.fillRect(player.x + 15, player.y + 10, 5, 5);
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}

function handleInput(e) {
    if (e.type === 'keydown' && e.code !== 'Space') return;
    
    if (gameActive) {
        if (player.jumpCount < player.maxJumps) {
            player.dy = jumpPower;
            player.jumpCount++;
        }
    } else {
        init();
    }
}

window.addEventListener('keydown', handleInput);
window.addEventListener('mousedown', handleInput);

init();
loop();
</script>
</body>
</html>
